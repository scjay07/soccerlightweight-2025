
#include "Arduino.h"
#include "RPC.h"

#include <Adafruit_NeoPixel.h>
Adafruit_NeoPixel led(32, A11, NEO_GBR + NEO_KHZ800);

#define norte 1
#define leste 2
#define sul 3
#define oeste 4

const int minluz[] = {11, 5, 15, 11, 4, 13, 7, 0, 16, 7, 13};
const int maxluz[] = {35, 39, 26, 20, 13, 27, 15, 1, 35, 13, 39};

const int tetocor = 49;
const int tetocor2 = 46;
const int tetocor3 = 50;
const int portasluz[] = { A0, A1, A2, A3, A4, A5, A6, A7, A8, A9, A10 };
float valorluz[11];
int direcao;

int atualizarDirecao() {
  return direcao;
}

void atualizarLuz() {
  for (int i = 0; i < 11; i++) {
    valorluz[i] = analogRead(portasluz[i]);
    valorluz[i] = (int)map(valorluz[i], minluz[i], maxluz[i], 0, 50);
    valorluz[i] = constrain(valorluz[i], 0, 50);
  }
  if (valorluz[2] >= tetocor3 || valorluz[3] >= tetocor3 || valorluz[4] >= tetocor3) // o sensor 4 ta aumentando muito quando liga o robo
  {
    //vai para leste
    direcao = leste;

  }
  else if (valorluz[5] >= tetocor || valorluz[6] >= tetocor || valorluz[7] >= tetocor)
  {
    //vai para norte
    direcao = norte;

  }
  else if (valorluz[8] >= tetocor || valorluz[9] >= tetocor || valorluz[10] >= tetocor)
  {
    //vai para oeste
    direcao = oeste;

  }
  if (valorluz[0] >= tetocor || valorluz[1] >= tetocor) {
    //vai para sul
    direcao = sul;
  }
}

void setup() {
  // put your setup code here, to run once:
  RPC.begin();
  Serial.begin(9600);
  RPC.bind("atualizarDirecao", atualizarDirecao);
  led.begin();
  for (int k = 0; k < 32; k++) {
    led.setPixelColor(k, led.Color(0, 0, 255));
  }
  led.show();
  for (int i = 0; i < 11; i++) {
    pinMode(portasluz[i], INPUT);
  }
  Serial.println("INICIADO");

}

void loop() {
  // put your main code here, to run repeatedly:
  atualizarLuz();
}
